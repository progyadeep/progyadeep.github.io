<html>
    <head>
        <title>VFR Navlog &bull; FlyByProggy</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/></span>
        <link rel="stylesheet" href="../css.common.css"/></span>
        <style>
            
            textarea{
                padding:0 0 0 0!important;
                margin:0 0 0 0!important;
                width:100%;
                height:calc(100% - 10px);
                text-align: center;
                border:none;
                resize: none;
            }
            
            button{
                cursor:pointer;
                color:#fff;
                padding:2 20 2 20;
                font-size: 16;
                border-radius:5px;
                border:none;
                transition: 0.1s;
            }

            button:hover{
                opacity:0.85;
                transition: 0.1s;
            }
            
            body{
                margin:0;
                padding:0;
            }

            div#top-bar{
                position:fixed;
                z-index:1;
                background-color:#56c;
                width:100%;
                color:#fff!important;
                text-align:center;
            }

            div.body-main{
                display:block;
            }

            div.navlog-row-container{
                display:flex;
                width:100%;
            }

            div.navlog-row{
                display:flex;
                width:calc(100% - 50px);
            }

            div.navlog-cell{
                display:inline-block;
                width:10%;
                background-color:#eaebed;
                text-align: center;
                border-bottom:solid 0.5px #000;
                border-left:solid 0.5px #000;
                border-right:solid 0.5px #000;
            }

            div.navlog-cell-compound{
                width:10%;
                text-align:center;
            }

            div.navlog-cell-compound > div{
                padding:10 0 10 0;
                border-bottom:solid 0.5px #000;
                border-left:solid 0.2px #000;
                border-right:solid 0.2px #000;
            }

            div.nav-label-row div.navlog-cell{
                background-color: #fff!important;
            }

            div.side-button{
                display:inline-block;
                width:50px;
                background: #56c;
                color: #fff;
                font-weight:bold;
                text-align: center;
            }

            div.side-button span{
                cursor: pointer;
            }

            div.navlog-row-container span{
                display:inline-block;
                position:relative;
                top: 50%;
                transform: translate(0, -50%);
            }

            input{
                width:80%;
                text-align: center;
            }

            div.bottom-bar{
                width:100%;
                background-color:#56c;
                color:#fff;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div id="top-bar">
            <div><br/><b><big>VFR NAVLOG</big></b><br/>
                <span id="top-bar-hp-link" style="cursor:pointer">&gt;&gt; https://flybyproggy.sly.io &lt;&lt;</span></div>
            <br/>
        </div>
        <div id="body-main" class="body-main">

            <div class="navlog-row-container nav-label-row">
                <div class="navlog-row" style="font-weight:bold;">
                        <div class="navlog-cell"><span>From<br/>To</span></div>
                        <div class="navlog-cell-compound">
                            <div>ALT</div>
                            <div>Temp</div>
                        </div>
                        <div class="navlog-cell-compound">
                            <div>TAS</div>
                            <div>CAS</div>
                        </div>
                        <div class="navlog-cell"><span>TRK Mag</span></div>
                        <div class="navlog-cell"><span>W/V Mag</span></div>
                        <div class="navlog-cell"><span>HDG Mag</span></div>
                        <div class="navlog-cell"><span>GS</span></div>
                        <div class="navlog-cell"><span>DIST</span></div>
                        <div class="navlog-cell">
                            <span>Fuel Req<br/><input style="margin-top:5px" id="gph" type="number" placeholder="G.P.H"/></span>
                        </div>
                        <div class="navlog-cell"><span>E.T.E</span></div>
                </div>
                <div class="side-button" style="background-color:orange!important;">
                    <span onclick="javascript:calc()">&#65309;</span>
                </div>
            </div>

            <div class="navlog-row-container">
                <div class="navlog-row">
                    <div class="navlog-cell"><span><textarea></textarea></span></div>
                    <div class="navlog-cell-compound">
                        <div><input class="alt" type="number"/></div>
                        <div><input class="temp" type="number"/></div>
                    </div>
                    <div class="navlog-cell-compound">
                        <div><input class="tas" type="number"/></div>
                        <div><input class="cas" type="number"/></div>
                    </div>
                    <div class="navlog-cell"><span><input class="tru-trk" type="number"/></span></div>
                    <div class="navlog-cell"><span><input class="wv" type="text"/></span></div>
                    <div class="navlog-cell"><span><input class="hdg-tru" type="number"/></span></div>
                    <div class="navlog-cell"><span><input class="gs" type="number"/></span></div>
                    <div class="navlog-cell"><span><input class="dist" type="text"/></span></div>
                    <div class="navlog-cell"><span><input class="fuel" type="text"/></span></div>
                    <div class="navlog-cell"><span><input class="ete" type="number"/></span></div>
                </div>
                <div class="side-button"><span onclick="javascript:delLeg(this)">X</span></div>
            </div>
        </div>

        <!----------------------Dummy row to support "+" button------------------------------>
        <div class="navlog-row-container">
            <div class="navlog-row" style="visibility:hidden; width:calc(100% - 51px)!important;">
                <div class="navlog-cell-compound">
                    <div><input/></div>
                    <div><input /></div>
                </div>
            </div>
            <div class="side-button" style="background-color:#4d4!important; width:51px;"><span onclick="javascript:addLeg()">&#x271B;</span></div>
        </div>

        <div class="bottom-bar">
            <br/>
                Total:-&nbsp; <span id="tot_dist"><b>0</b></span> NM, <span id="tot_fuel"><b>0.0</b></span> Gal, <span id="tot_ete"><b>0.0</b></span> mins
            <br/><br/>
        </div>
        
    </body>
    <script>
        document.getElementById('body-main').style.paddingTop = document.getElementById('top-bar').offsetHeight;
        document.getElementById('top-bar-hp-link').onclick= function(){
            window.location.href = '/';
        }

        function addLeg(){
            var tr = document.createElement('tr');
            tr.innerHTML= "<div class=\"navlog-row-container\">"
                            +"<div class=\"navlog-row\" style=\"font-weight:bold;\">"
                            +"<div class=\"navlog-cell\"><span><textarea></textarea></span></div>"
                            +"<div class=\"navlog-cell-compound\">"
                            +"<div><input class=\"alt\" type=\"number\"/></div>"
                            +"<div><input class=\"temp\" type=\"number\"/></div>"
                            +"</div>"
                            +"<div class=\"navlog-cell-compound\">"
                            +"<div><input class=\"tas\" type=\"number\"/></div>"
                            +"<div><input class=\"cas\" type=\"number\"/></div>"
                            +"</div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"tru-trk\" type=\"number\"/></span></div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"wv\" type=\"text\"/></span></div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"hdg-tru\" type=\"number\"/></span></div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"gs\" type=\"number\"/></span></div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"dist\" type=\"text\"/></span></div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"fuel\" type=\"text\"/></span></div>"
                            +"<div class=\"navlog-cell\"><span><input class=\"ete\" type=\"number\"/></span></div>"
                            +"</div>"
                            +"<div class=\"side-button\"><span onclick=\"javascript:delLeg(this)\">X</span></div>"
                            +"</div>";
            document.getElementById('body-main').appendChild(tr);
        }
        
        function delLeg(x){
            var target = x.parentNode.parentNode;
            target.parentNode.removeChild(target);
        }
        
        function calc(){
            var tot_dist=0.0, tot_fuel=0.0, tot_ete=0.0;

            //fetching the fields
            var alts = document.getElementsByClassName('alt');
            var tass = document.getElementsByClassName('tas');
            var tracks = document.getElementsByClassName('tru-trk');
            var winds = document.getElementsByClassName('wv');
            var headings = document.getElementsByClassName('hdg-tru');
            var ground_speeds = document.getElementsByClassName('gs');
            var distances = document.getElementsByClassName('dist');
            var fuel_reqs = document.getElementsByClassName('fuel');
            var etes = document.getElementsByClassName('ete');
            
            //filler variables
            var alt_this = alts[0].value;
            var tas_this = tass[0].value;
            var wv_this = winds[0].value;
            
            //loop
            for(var x=0; x<alts.length; x++){
                alts[x].value!=""?alt_this=alts[x].value:alts[x].value=alt_this;
                tass[x].value!=""?tas_this=tass[x].value:tass[x].value=tas_this;
                winds[x].value!= ""?wv_this=winds[x].value:winds[x].value=wv_this;
                
                //calculating wind correction angle and (mag) heading
                var wv_c = winds[x].value.split("@");
                var trk = parseInt(tracks[x].value);
                trk = trk==0?360:trk;
                var d = parseInt(wv_c[0])-trk;
                d = d>180?d-360:d;
                
                var wca = Math.asin(parseFloat(wv_c[1])/parseFloat(tas_this)*Math.sin(d*Math.PI/180.0))*180.0/Math.PI;
                //rounding off
                wca = 1.0*Math.round(wca);
                hdg = trk + wca;
                hdg = hdg>360?hdg-360:(hdg<0?360+hdg:hdg);
                
                //formatting with 0s
                headings[x].value = hdg<10?"00"+hdg:(hdg<100?"0"+hdg:hdg);                
                
                //calculating ground speed
                var tas_c = Math.cos(Math.abs(wca)*Math.PI/180.0)*parseInt(tas_this); //trk component of AS
                var hwd_c = Math.cos(d*Math.PI/180.0)*parseInt(wv_c[1]); //headwind component
                var gs = Math.round(tas_c - hwd_c); //groundspeed
                ground_speeds[x].value = gs;
                
                var d_t = parseFloat(distances[x].value);
                tot_dist+= d_t;

                //calculating fuel and ETE
                var ete = d_t/gs;
                var fuel = 0;

                if(fuel = ete*parseFloat(document.getElementById('gph').value)){
                    fuel_reqs[x].value = fuel.toFixed(1);
                    tot_fuel+= parseFloat(fuel.toFixed(1));
                }
                etes[x].value = (ete*60).toFixed(1);

                tot_ete+= parseFloat((ete*60).toFixed(1));
            }

            document.getElementById('tot_dist').innerHTML = "<b>"+tot_dist+"</b>";
            document.getElementById('tot_fuel').innerHTML = "<b>"+tot_fuel+"</b>";
            document.getElementById('tot_ete').innerHTML = "<b>"+tot_ete+"</b>";
        }
    </script>
</html>